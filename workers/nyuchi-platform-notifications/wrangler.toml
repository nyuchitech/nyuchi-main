# Nyuchi Platform Notifications Worker
# Email and notification service

name = "nyuchi-platform-notifications"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]
account_id = "125a2dfbc21f76a25c980609609e8218"

# ============================================
# Production Environment
# ============================================
[env.production]
name = "nyuchi-platform-notifications"

[env.production.vars]
ENVIRONMENT = "production"
FROM_EMAIL = "noreply@nyuchi.com"
FROM_NAME = "Nyuchi Africa"

# Queue consumer
[[env.production.queues.consumers]]
queue = "nyuchi-notifications-queue"
max_batch_size = 10
max_retries = 3
max_batch_timeout = 30

# KV for rate limiting
[[env.production.kv_namespaces]]
binding = "CACHE"
id = "cc4d7dd5c17144fb90b1109ba8726ad3"

# Observability
[env.production.observability]
[env.production.observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true

# ============================================
# Development defaults
# ============================================
[vars]
ENVIRONMENT = "development"
FROM_EMAIL = "dev@nyuchi.com"
FROM_NAME = "Nyuchi Africa (Dev)"

[[queues.consumers]]
queue = "nyuchi-notifications-queue"
max_batch_size = 10
max_retries = 3
max_batch_timeout = 30

[[kv_namespaces]]
binding = "CACHE"
id = "cc4d7dd5c17144fb90b1109ba8726ad3"
