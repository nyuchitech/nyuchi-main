---
/**
 * Blog Index Page
 * List all blog posts
 */
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/sections/Hero.astro';
import BlogCard from '../../components/blog/BlogCard.astro';

// Get all non-draft blog posts sorted by date
const allPosts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Get featured posts
const featuredPosts = allPosts.filter(post => post.data.featured);

// Get all unique categories
const categories = [...new Set(allPosts.map(post => post.data.category))];
---

<BaseLayout
  title="Blog - Nyuchi Africa"
  description="Stories, insights, and updates from the Nyuchi Africa community. Explore our thoughts on Ubuntu philosophy, technology, culture, and more."
>
  <Hero
    variant="light"
    subtitle="Our Blog"
    title="Stories from the Hive"
    description="Insights on Ubuntu philosophy, African technology, cultural preservation, and community building."
  />

  <!-- Featured Posts -->
  {featuredPosts.length > 0 && (
    <section class="py-12 bg-gray-50 dark:bg-gray-800">
      <div class="container-custom">
        <h2 class="font-heading text-2xl font-bold text-nyuchi-charcoal dark:text-white mb-8">
          Featured Posts
        </h2>
        <div class="grid md:grid-cols-2 gap-8">
          {featuredPosts.slice(0, 2).map((post) => (
            <BlogCard
              title={post.data.title}
              description={post.data.description}
              author={post.data.author}
              pubDate={post.data.pubDate}
              category={post.data.category}
              slug={post.slug}
              featured={true}
              heroImage={post.data.heroImage}
            />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Category Filter -->
  <section class="py-8 border-b border-gray-200 dark:border-gray-700">
    <div class="container-custom">
      <div class="flex flex-wrap items-center gap-3">
        <span class="text-sm font-medium text-gray-600 dark:text-gray-300">Filter by:</span>
        <a
          href="/blog"
          class="px-4 py-2 text-sm font-medium bg-nyuchi-orange text-white rounded-full"
        >
          All
        </a>
        {categories.map((category) => (
          <a
            href={`/blog?category=${category}`}
            class="px-4 py-2 text-sm font-medium bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 rounded-full hover:bg-nyuchi-orange/10 hover:text-nyuchi-orange transition-colors"
          >
            {category}
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- All Posts -->
  <section class="py-16 md:py-24">
    <div class="container-custom">
      {allPosts.length > 0 ? (
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          {allPosts.map((post) => (
            <BlogCard
              title={post.data.title}
              description={post.data.description}
              author={post.data.author}
              pubDate={post.data.pubDate}
              category={post.data.category}
              slug={post.slug}
              heroImage={post.data.heroImage}
            />
          ))}
        </div>
      ) : (
        <div class="text-center py-16">
          <span class="text-6xl mb-4 block">üìù</span>
          <h3 class="font-heading text-2xl font-semibold text-nyuchi-charcoal dark:text-white mb-2">
            No posts yet
          </h3>
          <p class="text-gray-600 dark:text-gray-300">
            We're working on some great content. Check back soon!
          </p>
        </div>
      )}
    </div>
  </section>
</BaseLayout>
